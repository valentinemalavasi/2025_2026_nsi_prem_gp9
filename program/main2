from  tools_file import *
from data import *

virement = ["payment"]
sold = ["sold"]
retrait = ["withdrawal"]

def data ():
    with open ("tools_file","r"):  # ❌ ERROR: Should use 'tools_file.py' not 'tools_file'; Missing 'encoding' parameter; Missing 'close()' or use context manager
        return data = tools_file.PY  # ❌ ERROR: Invalid syntax 'return data = '; should be 'return tools_file' or just 'data'


# La fonction sld permet de retourner le solde du client
def sld ():
    for account in data:
        return account["sold"]  # ❌ WARNING: Will only return first account; data() function not called

# La fonction old_withdrawal permet de retourner les anciens retraits du client
def old_withdrawal ():
    for account in data:
        return account["withdrawal"]  # ❌ WARNING: Same issue as sld()

    # FONCTION a retravailler et connecter solde aux comptes 
def new_sold_received (recipient, payment_amount):
    sld = sld + n  # ❌ ERROR: 'n' is undefined; attempting to assign to function 'sld'; infinite recursion
    return sld

def new_sold_given (n):
    sld = sld - n  # ❌ ERROR: 'sld' is a function, not a variable; attempting to assign to function
    if sld < 0 :
        print ("Vous êtes dans le rouge ")
    return sld

def make_a_payment () :
    recipient = input("Enter the name of the recipient (enter 'quit' to cancel): ")
    payment_amount = input("Enter the amount you want to transfer (enter 'quit' to cancel): ")
    if recipient or payment_amount in quitting_words :  # ❌ ERROR: 'quitting_words' is undefined; logic error (should be 'and' not 'or')
        go_to_payment_page  # ❌ ERROR: Missing function call parentheses '()'
    else :
        input(f"Enter 1 to make a {payment_amount} € payment to {recipient}: \n"
                "Enter 2 to cancel")  # ❌ ERROR: Input value not stored in variable
        if input == 1 :  # ❌ ERROR: 'input' is a function, comparing to 1 doesn't work
            new_sold_given, new_sold_received  # ❌ ERROR: Functions not called; missing parentheses and arguments
            print ("payment made !")
        elif input == 2 :  # ❌ ERROR: Same issue as above
            go_to_payment_page  # ❌ ERROR: Missing function call parentheses '()'
        
    
        
# La fonction montre la page permettant de faire des virements
def go_to_payment_page ():
    print("To make a payment, enter 1.\n"
          "To go back to main page, enter 2.")
    if int(input) == 1:  # ❌ ERROR: 'input' is a function; should be input() to get user input
        make_a_payment ()
    elif int(input) == 2:  # ❌ ERROR: Same issue; also int(function) will fail
        main_page ()

def go_to_sold_page ():
    print(f"Your sold is {sld}")  # ❌ ERROR: 'sld' is a function; should be sld() to call it

def go_to_withdrawal_page () :
    print (f"Your old withdrawals are {old_withdrawal}.\n")  # ❌ ERROR: 'old_withdrawal' is a function; should be old_withdrawal()
           #entrez pin si vous voulez retirer argent)
    
def enter_pin ():
    tentative = int(input("enter your pin"))
    pin= ""  # ❌ ERROR: 'pin' is a string but compared with int 'tentative'; should be int
    while tentative != pin:
        tentative = int(input("reenter your pin"))
        if pin==tentative:  # ❌ ERROR: pin is "", will never equal tentative
            print("code correct")

def vnew_sold ():  # ❌ ERROR: Function name typo 'vnew_sold' should be 'new_sold' or similar
   value_to_withdraw = int(input("Enter the value you want to withdraw : "))
   print(sld-value_to_withdraw)  # ❌ ERROR: 'sld' is a function; should be sld()

def exit_system():
    return main(account)  # ❌ ERROR: 'account' is undefined; should probably be 'name'

 

# La fonction main_page permet de demander ce que veux regarder le client sur son compte bancaire.
def main_page ():
    input(f"Hello {FName}, {Name}, what do you want to know about your bank account?\n"  # ❌ ERROR: 'FName' and 'Name' undefined; input not stored
          "sold\n"
          "payment\n"
          "withdrawal")
    if input in sold:  # ❌ ERROR: 'input' is a function, not the user's response
        go_to_sold_page()
    if input in virement:  # ❌ ERROR: Same issue
        go_to_payment_page()
    if input in retrait:  # ❌ ERROR: Same issue
        go_to_withdrawal_page()
    if input in quitting_words:  # ❌ ERROR: 'quitting_words' undefined
        exit_system()

def is_a_valid_name (name):
    return name in clients.keys ()

def is_a_valid_first_name (name, first_name):
    return first_name == clients [name]["Fname"]

def is_a_valid_passwd (name, password):
    return password == clients [name]["password"]

# La fonction "ask_identity" permet de demander à l'utilisateur de rentrer les codes du client.
def identity_is_valid (name, first_name, password):
    if is_a_valid_name (name) \
        and is_a_valid_first_name (name, first_name) \
        and is_a_valid_passwd (name, password):
        return True
    else:
        return False

def add_amount (amount, name):
    clients [name]["sold"] = clients [name]["sold"] + amount
    
def main ():  
    name = input ("name : ")
    first_name = input ("Fname : ")
    password =input ("password : ")
    if identity_is_valid ("Name", "Fname", "password"):  # ❌ ERROR: Passing string literals instead of variables; should be identity_is_valid(name, first_name, password)
        print("Login succesfull!")
        #montant_a_deposer = float (input ("Entrez un montant: "))
        #add_amount (montant_a_deposer, "Canard")
        #write_in_json_file (clients, "toto.json")
        main_page(account)  # ❌ ERROR: 'account' is undefined; main_page() takes no arguments
    else:
        print("Login error, please try again.")
        main()


clients = load_data_from_json ("data.json")
main ()
